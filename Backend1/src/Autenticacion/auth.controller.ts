import { Controller, Post, Body, HttpCode, HttpStatus, HttpException, UseGuards, Get, Req } from '@nestjs/common';
import { AuthService } from './auth.service';
import { LoginDto } from './dto/auth.dto';
import { JwtAuthGuard } from './jwt-auth.guard';

@Controller()
export class AuthController {
  constructor(private readonly authService: AuthService) {}

  // 游댏 Endpoint para iniciar sesi칩n
@Post('login')
@HttpCode(HttpStatus.OK)
async login(@Body() LoginDto: { data: { type: string; attributes: { user_name: string; password: string } } }) {
  const { type, attributes } = LoginDto.data;


  // Validar que el tipo sea 'token'
  if (type !== 'token') {
    throw new HttpException('Tipo de datos no v치lido', HttpStatus.BAD_REQUEST);
  }

  // Extraer user_name y password de attributes
  const { user_name, password } = attributes;

  // Llamar al servicio con los datos extra칤dos
  return this.authService.login(user_name, password);
}

  @UseGuards(JwtAuthGuard)
  @Get('getProfile')
  async getProfile(@Req() req: Request) {
    const idUser = req['userId']; // Extrae el ID del usuario del request
    const perfil=  this.authService.getProfile(idUser);
    
    return perfil
  }
}

/*
  // 游닇 Endpoint para registrar un nuevo usuario
  @Post('register')
  @HttpCode(HttpStatus.CREATED)
  async register(@Body() registerDto: RegisterDto) {
    return this.authService.register(registerDto.name, registerDto.email, registerDto.password);
  }

  // 游대 Endpoint para solicitar cambio de contrase침a
  @Post('forgot-password')
  @HttpCode(HttpStatus.OK)
  async forgotPassword(@Body() forgotPasswordDto: ForgotPasswordDto) {
    return this.authService.forgotPassword(forgotPasswordDto.email);
  }

  // 游댃 Endpoint para restablecer la contrase침a
  @Post('reset-password')
  @HttpCode(HttpStatus.OK)
  async resetPassword(@Body() resetPasswordDto: ResetPasswordDto) {
    return this.authService.resetPassword(
      resetPasswordDto.email,
      resetPasswordDto.token,
      resetPasswordDto.password,
      resetPasswordDto.password_confirmation,
    );
  }
    */

